<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FlatDrive Ù…Ø¹ Ø³Ø­Ø¨ ÙØ¹Ù„ÙŠ</title>
  <style>
    /* CSS ÙƒÙ…Ø§ Ù‚Ø¨Ù„ */
    body { font-family: Arial, sans-serif; background: #0f172a; color: #e6eef8; padding: 20px; display: flex; justify-content: center; }
    .game-container { width: 760px; background: #0b1220; padding: 18px; border-radius: 10px; box-shadow: 0 6px 24px rgba(2,6,23,0.6); }
    h1 { font-size: 20px; margin-bottom: 10px; }
    .info { display: flex; flex-wrap: wrap; justify-content: space-between; background: #071026; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
    canvas { width:100%; height:140px; background:#02111b; border-radius:8px; display:block; margin:12px 0; }
    .controls { margin-bottom:16px; }
    button { background:#0ea5a6; color:#041014; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; margin:4px 8px 4px 0; }
    select { width:100%; padding:8px; border-radius:6px; border:1px solid rgba(255,255,255,0.06); background:#02121a; color:white; margin-top:6px; }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>ğŸš— FlatDrive â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù…Ø¹ Ø§Ù„Ø³Ø­Ø¨</h1>
    <div class="info">
      <div>USDC Ø§Ù„Ù…ÙƒØªØ³Ø¨: <strong id="trxEarned">0</strong></div>
      <div>Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©: <span id="distance">0</span> Ù…ØªØ±</div>
      <div>Ø±ØµÙŠØ¯ Ø¯Ø§Ø®Ù„ÙŠ (USDC): <span id="wallet">0.00</span></div>
      <div>ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© (USDC): <span id="gameFund">0.00</span></div>
      <div>Ø§Ù„Ø­Ø§Ù„Ø©: <span id="status">Ù…ØªÙˆÙ‚ÙØ©</span></div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <div class="controls">
      <select id="carColor">
        <option value="#ff6b6b">Ø£Ø­Ù…Ø±</option>
        <option value="#4ade80">Ø£Ø®Ø¶Ø±</option>
        <option value="#3b82f6">Ø£Ø²Ø±Ù‚</option>
        <option value="#facc15">Ø£ØµÙØ±</option>
      </select>
      <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</button>
      <button id="stopBtn">ØªÙˆÙ‚Ù</button>
      <button id="collectBtn">Ø§Ø¬Ù…Ø¹ (ØªØ­ÙˆÙŠÙ„ ÙØ¹Ù„ÙŠ)</button>
      <button id="convertFund">ØªØ­ÙˆÙŠÙ„ ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
    </div>
  </div>

  <!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@zerodev/sdk@latest/dist/zerodev-sdk.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      canvas.width = 720;
      canvas.height = 140;

      let running = false;
      let trxEarned = 0;
      let wallet = 0;
      let gameFund = 0;
      let distance = 0;

      let carX = 10;
      let carColor = "#ff6b6b";
      let speedLevel = 0;
      let speed = 10;

      const projectId = "29f50eca-d2a1-47ed-b388-a3bcf044a8a5"; // Ù…ÙØªØ§Ø­ Ù…Ø´Ø±ÙˆØ¹Ùƒ
      const recipientAddress = "0xcaBb5186Ee6CcB0F8C8ac3Ae85f4C94308cA106A";

      // ØªÙ‡ÙŠØ¦Ø© SDK
      let walletSDK;
      try {
        walletSDK = await Zerodev.init({ projectId });
      } catch (err) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Zerodev:", err);
        alert("Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø°ÙƒÙŠØ©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        return;
      }

      function updateUI() {
        document.getElementById("trxEarned").textContent = trxEarned.toFixed(2);
        document.getElementById("wallet").textContent = wallet.toFixed(2);
        document.getElementById("gameFund").textContent = gameFund.toFixed(2);
        document.getElementById("distance").textContent = distance;
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#08323a";
        ctx.fillRect(0, canvas.height - 20, canvas.width, 20);

        ctx.fillStyle = carColor;
        ctx.fillRect(carX, canvas.height - 44, 60, 28);

        ctx.fillStyle = "#061119";
        ctx.beginPath();
        ctx.arc(carX + 12, canvas.height - 12, 8, 0, Math.PI * 2);
        ctx.fill();

        ctx.beginPath();
        ctx.arc(carX + 48, canvas.height - 12, 8, 0, Math.PI * 2);
        ctx.fill();
      }

      function gameTick() {
        if (!running) return;
        carX += speed;
        if (carX > canvas.width) carX = -80;
        distance += speed;
        if (Math.random() < 0.9) {
          trxEarned += Math.floor(Math.random() * 5) + 1;
        }
        updateUI();
        draw();
        requestAnimationFrame(gameTick);
      }

      document.getElementById("carColor").onchange = e => {
        carColor = e.target.value;
      };

      document.getElementById("startBtn").onclick = () => {
        speedLevel++;
        if (speedLevel === 1) speed = 10;
        else if (speedLevel === 2) speed = 20;
        else if (speedLevel === 3) speed = 35;
        else speed = 60;
        running = true;
        document.getElementById("status").textContent = "ØªØ¹Ù…Ù„";
        gameTick();
      };

      document.getElementById("stopBtn").onclick = () => {
        running = false;
        document.getElementById("status").textContent = "Ù…ØªÙˆÙ‚ÙØ©";
      };

      document.getElementById("collectBtn").onclick = async () => {
        if (trxEarned < 1) {
          alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±Ø¨Ø§Ø­ ÙƒØ§ÙÙŠØ© Ù„Ù„Ø³Ø­Ø¨.");
          return;
        }

        const fundFee = trxEarned * 0.05;
        const netEarned = trxEarned - fundFee;

        // ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… SDK
        try {
          document.getElementById("status").textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...";
          const tx = await walletSDK.sendERC20({
            token: "USDC",
            to: recipientAddress,
            amount: netEarned.toString(),
          });

          // Ø¥Ø°Ø§ Ù†Ø¬Ø­Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©:
          gameFund += fundFee;
          wallet += netEarned;
          trxEarned = 0;
          updateUI();
          alert(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${netEarned.toFixed(2)} USDC Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸ØªÙƒ.`);
          document.getElementById("status").textContent = "ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„";
        } catch (error) {
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³Ø­Ø¨:", error);
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙØ¹Ù„ÙŠ.");
          document.getElementById("status").textContent = "Ù…ØªÙˆÙ‚ÙØ©";
        }
      };

      document.getElementById("convertFund").onclick = () => {
        if (gameFund <= 0) {
          alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±ØµÙŠØ¯ ØªÙ…ÙˆÙŠÙ„.");
          return;
        }
        wallet += gameFund;
        gameFund = 0;
        updateUI();
        alert("âœ… ØªÙ… ØªØ­ÙˆÙŠÙ„ ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©.");
      };

      updateUI();
      draw();
    });
  </script>
</body>
</html>
